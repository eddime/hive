# Build Optimizations

According to [Bun's documentation](https://bun.com/docs/bundler/executables#deploying-to-production), we use the following production flags:

## Recommended Production Build

```bash
bun build --compile --minify --sourcemap ./src/index.ts --outfile myapp
```

## What Each Flag Does

### `--minify`
- **Reduces code size** by ~200 KB (as shown in build output)
- Removes whitespace, shortens variable names
- Makes debugging harder (use source maps)
- **Enabled by default** in Hive

### `--sourcemap=external`
- Generates `.map` files for debugging
- Allows you to debug minified code
- Maps minified code back to original source
- **Enabled by default** in Hive

### `--bytecode` (Experimental)
- **2x faster startup time** (from ~100ms to ~50ms)
- Pre-compiles JavaScript to bytecode
- **Incompatible with top-level await**
- **Disabled by default** (webview-bun uses top-level await)

## Size Comparison

| Build Type | Size | Startup | Notes |
|------------|------|---------|-------|
| No minify | ~58.2 MB | ~100ms | Development |
| With minify | ~58.0 MB | ~100ms | **Production (default)** |
| With bytecode | ~58.0 MB | ~50ms | Incompatible with webview-bun |

## Configuration

Edit `hive.config.ts`:

```typescript
build: {
  minify: true,      // ✅ Enabled (reduces size ~200KB)
  sourcemap: true,   // ✅ Enabled (for debugging)
  bytecode: false,   // ❌ Disabled (incompatible with webview-bun)
}
```

## Cross-Platform Builds

All platforms are built with the same optimizations:

```bash
bun run build:all
```

Output (all minified):
- `dist/hive-darwin-arm64` - 58 MB
- `dist/hive-darwin-x64` - 64 MB
- `dist/hive-linux-x64` - 100 MB
- `dist/hive-linux-arm64` - 93 MB
- `dist/hive-windows-x64.exe` - 114 MB

## References

- [Bun Executables Docs](https://bun.com/docs/bundler/executables)
- [Bytecode Compilation](https://bun.com/docs/bundler/executables#bytecode-compilation)
- [Production Deployment](https://bun.com/docs/bundler/executables#deploying-to-production)
